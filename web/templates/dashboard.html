<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Network Monitor - Security Dashboard</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">

    <style>
        /* Loading overlay */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #1a1a1a;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 1;
            transition: opacity 0.3s ease-out;
        }
        #loading-overlay.hide {
            opacity: 0;
            pointer-events: none;
        }
        .loading-spinner {
            text-align: center;
        }
        .spinner-border {
            width: 3rem;
            height: 3rem;
            border-width: 0.3rem;
        }
    </style>
</head>
<body class="bg-dark text-light">

    <!-- Loading Overlay -->
    <div id="loading-overlay">
        <div class="loading-spinner">
            <div class="spinner-border text-success" role="status"></div>
            <div class="text-light mt-3" id="loading-message">Loading Security Dashboard...</div>
            <div class="text-muted mt-2" style="font-size: 0.85rem;" id="loading-hint">
                Initializing components...
            </div>
        </div>
    </div>

    <!-- Navbar -->
    <nav class="navbar navbar-dark bg-black border-bottom border-secondary">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">
                <i class="bi bi-shield-check text-success"></i>
                Network Monitor - Security Dashboard
            </span>
            <div class="d-flex align-items-center">
                <span class="badge bg-success me-3" id="connection-status">
                    <i class="bi bi-wifi"></i> Connected
                </span>
                <span class="text-muted" id="current-time"></span>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-3">

        <!-- System Stats Row -->
        <div class="row mb-4">
            <!-- Packets/sec Gauge -->
            <div class="col-md-3">
                <div class="card bg-secondary text-white h-100">
                    <div class="card-body text-center">
                        <h6 class="card-title"><i class="bi bi-activity"></i> Packets/sec</h6>
                        <canvas id="packetsGauge" height="150"></canvas>
                        <h3 class="mt-2" id="packets-value">0</h3>
                    </div>
                </div>
            </div>

            <!-- Alerts/min Gauge -->
            <div class="col-md-3">
                <div class="card bg-secondary text-white h-100">
                    <div class="card-body text-center">
                        <h6 class="card-title"><i class="bi bi-exclamation-triangle"></i> Alerts/min</h6>
                        <canvas id="alertsGauge" height="150"></canvas>
                        <h3 class="mt-2" id="alerts-value">0</h3>
                    </div>
                </div>
            </div>

            <!-- CPU Usage -->
            <div class="col-md-3">
                <div class="card bg-secondary text-white h-100">
                    <div class="card-body text-center">
                        <h6 class="card-title"><i class="bi bi-cpu"></i> CPU Usage</h6>
                        <canvas id="cpuGauge" height="150"></canvas>
                        <h3 class="mt-2" id="cpu-value">0%</h3>
                    </div>
                </div>
            </div>

            <!-- Memory Usage -->
            <div class="col-md-3">
                <div class="card bg-secondary text-white h-100">
                    <div class="card-body text-center">
                        <h6 class="card-title"><i class="bi bi-memory"></i> Memory Usage</h6>
                        <canvas id="memoryGauge" height="150"></canvas>
                        <h3 class="mt-2" id="memory-value">0%</h3>
                    </div>
                </div>
            </div>
        </div>

        <!-- Remote Sensors Row -->
        <div class="row mb-3">
            <div class="col-12">
                <div class="card bg-secondary">
                    <div class="card-header d-flex justify-content-between align-items-center" style="cursor: pointer;" data-bs-toggle="collapse" data-bs-target="#sensorsCollapse">
                        <h5 class="mb-0">
                            <i class="bi bi-broadcast"></i> Remote Sensors
                            <span class="badge bg-info ms-2" id="sensors-count">0</span>
                            <span class="badge bg-success ms-1" id="sensors-online">0</span>
                        </h5>
                        <i class="bi bi-chevron-down"></i>
                    </div>
                    <div class="collapse show" id="sensorsCollapse">
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-dark table-sm table-hover mb-0">
                                    <thead>
                                        <tr>
                                            <th>Status</th>
                                            <th>Sensor</th>
                                            <th>Location</th>
                                            <th>CPU</th>
                                            <th>RAM</th>
                                            <th>Packets</th>
                                            <th>Alerts (24h)</th>
                                            <th>Last Seen</th>
                                        </tr>
                                    </thead>
                                    <tbody id="sensors-table">
                                        <tr>
                                            <td colspan="8" class="text-center text-muted">Loading sensors...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Traffic Stats Row -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card bg-secondary h-100">
                    <div class="card-header">
                        <h5><i class="bi bi-graph-up"></i> Traffic Volume (24h)</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="trafficChart" height="200"></canvas>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card bg-secondary h-100">
                    <div class="card-header">
                        <h5><i class="bi bi-pie-chart"></i> Alert Distribution</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="alertPieChart" height="200"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Row -->
        <div class="row">
            <!-- Recent Alerts -->
            <div class="col-lg-6 col-md-12 mb-3">
                <div class="card bg-secondary h-100">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5><i class="bi bi-bell"></i> Recent Alerts</h5>
                        <span class="badge bg-danger" id="alert-count">0</span>
                    </div>
                    <div class="card-body p-0">
                        <div class="alert-feed" id="alert-feed">
                            <div class="text-center text-muted p-4">
                                Loading alerts...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Top Talkers -->
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="card bg-secondary h-100">
                    <div class="card-header">
                        <h5><i class="bi bi-people"></i> Top Talkers</h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-dark table-sm table-hover mb-0">
                                <thead>
                                    <tr>
                                        <th>IP/Hostname</th>
                                        <th>Traffic</th>
                                        <th>Dir</th>
                                    </tr>
                                </thead>
                                <tbody id="top-talkers-table">
                                    <tr>
                                        <td colspan="3" class="text-center text-muted">Loading...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Threat Types -->
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="card bg-secondary h-100">
                    <div class="card-header">
                        <h5><i class="bi bi-bug"></i> Threat Types</h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="list-group list-group-flush" id="threat-types-list">
                            <div class="list-group-item bg-dark text-muted text-center">
                                Loading...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Alert Details Modal -->
    <div class="modal fade" id="alertDetailsModal" tabindex="-1" aria-labelledby="alertDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content bg-dark text-light">
                <div class="modal-header">
                    <h5 class="modal-title" id="alertDetailsModalLabel">
                        <i class="bi bi-info-circle"></i> Alert Details
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="alertDetailsBody">
                    <!-- Alert details will be populated here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Threat Type Details Modal -->
    <div class="modal fade" id="threatDetailsModal" tabindex="-1" aria-labelledby="threatDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content bg-dark text-light">
                <div class="modal-header">
                    <h5 class="modal-title" id="threatDetailsModalLabel">
                        <i class="bi bi-bug-fill"></i> Threat Details
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="threatDetailsBody">
                    <!-- Loading indicator -->
                    <div id="threatDetailsLoading" class="text-center p-4">
                        <div class="spinner-border text-success" role="status"></div>
                        <div class="text-muted mt-2">Loading threat details...</div>
                    </div>
                    <!-- Threat details will be populated here -->
                    <div id="threatDetailsContent" style="display: none;">
                        <!-- Statistics Cards -->
                        <div class="row mb-4" id="threatStatsRow">
                            <!-- Statistics will be populated here -->
                        </div>

                        <!-- Tabs -->
                        <ul class="nav nav-tabs mb-3" id="threatDetailsTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview-pane" type="button" role="tab">
                                    <i class="bi bi-grid"></i> Overview
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="sources-tab" data-bs-toggle="tab" data-bs-target="#sources-pane" type="button" role="tab">
                                    <i class="bi bi-hdd-network"></i> Source IPs
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="targets-tab" data-bs-toggle="tab" data-bs-target="#targets-pane" type="button" role="tab">
                                    <i class="bi bi-hdd-network-fill"></i> Targets
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="alerts-tab" data-bs-toggle="tab" data-bs-target="#alerts-pane" type="button" role="tab">
                                    <i class="bi bi-list-ul"></i> All Alerts
                                </button>
                            </li>
                        </ul>

                        <!-- Tab Content -->
                        <div class="tab-content" id="threatDetailsTabContent">
                            <!-- Overview Tab -->
                            <div class="tab-pane fade show active" id="overview-pane" role="tabpanel">
                                <div id="threatOverviewContent"></div>
                            </div>

                            <!-- Sources Tab -->
                            <div class="tab-pane fade" id="sources-pane" role="tabpanel">
                                <div class="table-responsive">
                                    <table class="table table-dark table-striped">
                                        <thead>
                                            <tr>
                                                <th>Source IP</th>
                                                <th>Hostname</th>
                                                <th>Country</th>
                                                <th>Count</th>
                                            </tr>
                                        </thead>
                                        <tbody id="threatSourcesTable"></tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Targets Tab -->
                            <div class="tab-pane fade" id="targets-pane" role="tabpanel">
                                <div class="table-responsive">
                                    <table class="table table-dark table-striped">
                                        <thead>
                                            <tr>
                                                <th>Target IP</th>
                                                <th>Hostname</th>
                                                <th>Country</th>
                                                <th>Count</th>
                                            </tr>
                                        </thead>
                                        <tbody id="threatTargetsTable"></tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- All Alerts Tab -->
                            <div class="tab-pane fade" id="alerts-pane" role="tabpanel">
                                <div id="threatAlertsContent"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- External Libraries - Load asynchronously for better performance -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" defer></script>
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" defer></script>

    <!-- Custom JS - Load last with defer -->
    <script src="{{ url_for('static', filename='js/dashboard.js') }}" defer></script>

    <!-- Hide loading overlay when DOM is ready -->
    <script>
        window.addEventListener('load', function() {
            setTimeout(function() {
                document.getElementById('loading-overlay').classList.add('hide');
            }, 300);
        });
    </script>

</body>
</html>
